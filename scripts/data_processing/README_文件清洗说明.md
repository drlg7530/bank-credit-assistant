# 文件清洗脚本使用说明

## 功能说明

`file_cleaning.py` 脚本用于清洗政策文档，主要功能：

1. **识别图片文件**：自动识别需要OCR处理的图片（PNG、JPG等）
2. **OCR文本提取**：使用PaddleOCR从图片中提取文本
3. **结构恢复**：将多张分割的图片文本合并，保持条款级连续性
4. **文件复制**：将不需要清洗的文档直接复制到processed目录

## 使用方法

```bash
python scripts/data_processing/file_cleaning.py
```

## 注意事项

### 1. 首次运行需要下载模型

PaddleOCR首次运行时会：
- 检查模型连接（可能需要10-30秒）
- 自动下载OCR模型文件（约100-200MB）
- 下载完成后会缓存在本地，后续运行会更快

**如果看到 "Checking connectivity to the model hosters" 提示，请耐心等待，这是正常现象。**

### 2. 网络要求

- 需要能够访问PaddleOCR的模型下载服务器
- 如果网络较慢，下载模型可能需要较长时间

### 3. 输出结果

- OCR处理后的图片会生成 `.md` 文件，保存在 `data/processed/policy/` 目录
- 文件名格式：`原文件夹名_OCR恢复.md` 或 `原文件名_OCR恢复.md`
- 普通文档直接复制到 `data/processed/policy/` 目录

## 处理流程

1. 扫描 `data/raw/policy/` 目录
2. 识别图片文件夹（如 `地方金融组织_新疆维吾尔自治区地方金融管理局`）
3. 对文件夹中的图片按文件名数字顺序排序
4. 逐张进行OCR识别
5. 合并所有图片的文本，保持结构
6. 保存为Markdown文件
7. 复制其他文档文件

## 故障排除

### 问题1：模型检查时间过长

**解决方案**：
- 检查网络连接
- 如果网络受限，可以手动下载模型文件
- 或者使用离线模式（需要预先下载模型）

### 问题2：OCR识别准确率低

**可能原因**：
- 图片质量较差
- 图片分辨率过低
- 文字模糊或倾斜

**解决方案**：
- 检查原始图片质量
- 可以尝试图片预处理（增强对比度、去噪等）

### 问题3：内存不足

**解决方案**：
- 减少同时处理的图片数量
- 使用GPU加速（如果可用）
- 分批处理大量图片

## 依赖安装

如果遇到模块缺失错误，请安装：

```bash
pip install paddlepaddle paddleocr -i https://pypi.tuna.tsinghua.edu.cn/simple
```


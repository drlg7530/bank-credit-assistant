# Flask Web应用使用说明

## 📋 功能说明

Flask Web应用提供了友好的Web界面，方便用户进行智能查询：

1. **用户输入查询**：支持文本输入和快捷问题选择
2. **角色选择**：支持选择不同角色（客户经理/团队负责人/行长）
3. **快捷问题**：根据角色显示不同的快捷问题列表
4. **查询结果展示**：显示答案、意图类型、监控信息等

## 🚀 启动方式

### 方式1：直接运行

```bash
python src/api/app_flask.py
```

### 方式2：使用Flask命令

```bash
# 设置环境变量
export FLASK_APP=src/api/app_flask.py
# 或 Windows PowerShell
$env:FLASK_APP="src/api/app_flask.py"

# 运行
flask run --host=0.0.0.0 --port=5000
```

### 方式3：作为模块运行

```bash
python -m src.api.app_flask
```

## 🌐 访问地址

启动后，在浏览器中访问：

```
http://127.0.0.1:5000
```

## 📱 使用说明

### 1. 选择角色

在页面顶部的下拉列表中选择用户角色：
- **客户经理**：默认角色，显示基础快捷问题
- **团队负责人**：显示更高级的快捷问题
- **行长**：显示最高级别的快捷问题

### 2. 选择快捷问题

- 选择角色后，页面会自动加载该角色的快捷问题
- 点击快捷问题标签，会自动填入查询框并执行查询

### 3. 输入自定义问题

- 在文本框中输入您的问题
- 支持多行输入
- 按 `Ctrl + Enter` 快速提交

### 4. 配置选项

- **启用Query改写**：是否使用大模型改写查询（默认启用）
- **启用重排序**：是否对搜索结果进行重排序（默认启用）

### 5. 查看结果

查询结果包含：
- **答案**：系统生成的最终答案
- **意图类型**：问题被识别为哪种意图
- **路由目标**：查询被路由到哪个模块
- **处理模块**：实际处理查询的模块
- **Token数**：本次查询消耗的Token数
- **耗时**：查询总耗时（毫秒）
- **改写后的查询**：如果启用了Query改写，显示改写后的查询

## 🔧 API接口

### 1. 查询接口

**URL**: `/api/query`

**方法**: `POST`

**请求体**:
```json
{
    "question": "小额贷款公司的注册资本要求是什么？",
    "role": "客户经理",
    "enable_rewrite": true,
    "enable_rerank": true
}
```

**响应**:
```json
{
    "success": true,
    "answer": "根据相关政策规定...",
    "question": "小额贷款公司的注册资本要求是什么？",
    "rewritten_query": "小额贷款公司注册资本要求",
    "intent": "policy_query",
    "route_to": "rag_policy",
    "module": "rag",
    "monitor": {
        "total_tokens": 1250,
        "total_latency_ms": 2340.5,
        "steps": [...]
    },
    "search_results": [...]
}
```

### 2. 快捷问题接口

**URL**: `/api/quick-questions`

**方法**: `GET`

**查询参数**:
- `role` (可选): 角色名称，如果不提供则返回所有角色的快捷问题

**响应**:
```json
{
    "success": true,
    "role": "客户经理",
    "questions": [
        "小额贷款公司的注册资本要求是什么？",
        "最新的LPR是多少？",
        ...
    ]
}
```

## 📦 依赖安装

确保已安装Flask：

```bash
# 使用pip安装
pip install flask

# 或使用清华镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple flask
```

## 🎨 界面特性

- **现代化设计**：渐变背景、圆角卡片、阴影效果
- **响应式布局**：适配不同屏幕尺寸
- **交互友好**：点击快捷问题自动查询、加载动画、错误提示
- **信息完整**：显示查询结果、监控信息、意图识别等

## ⚠️ 注意事项

1. **首次启动**：首次访问可能需要加载模型，响应时间较长
2. **网络要求**：如果使用百炼API，需要网络连接
3. **Elasticsearch**：确保Elasticsearch服务已启动
4. **端口占用**：默认使用5000端口，如果被占用请修改代码中的端口号

## 🔄 与命令行版本的区别

- **Web界面**：提供图形化界面，更适合业务人员使用
- **快捷问题**：提供常用问题快速选择
- **角色切换**：方便切换不同角色查看不同权限的问题
- **实时反馈**：显示加载状态和查询进度

## 📚 相关文件

- `src/api/app_flask.py` - Flask应用主文件
- `templates/index.html` - 前端页面模板
- `app.py` - 核心查询函数（被Flask应用调用）


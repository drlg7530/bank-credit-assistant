# 智能信贷业务辅助系统 - 项目结构说明

## 📁 项目目录结构

### 1. **data/** - 数据目录
存放项目所需的所有数据文件

#### `data/raw/` - 原始数据
- `policy/` - 原始政策文档（PDF、Word等格式）
- `system/` - 原始系统功能文档

#### `data/processed/` - 处理后的数据
- `policy/` - 清洗后的政策文档
- `system/` - 清洗后的系统功能文档

#### `data/parsed/` - 解析后的数据
- `policy/` - Mineru解析后的政策文档（Markdown格式）
- `system/` - Mineru解析后的系统功能文档（Markdown格式）

#### `data/qa_pairs/` - QA对数据
- `policy/` - 政策类QA对（50~100条）
- `system/` - 系统功能类QA对（50~80条）

#### `data/vector_db/` - 向量数据库
存放FAISS/Milvus向量库文件，包含：
- Embedding向量
- Metadata（域、政策类型、时间、权限等）

#### `data/customer/` - 客户数据
- 模拟客户数据（JSON/SQLite格式）
- 用于预测模块演示
- 包含客户经理字段

---

### 2. **src/** - 源代码目录
项目核心代码模块和说明文档

#### `src/rag/` - RAG系统模块
- `query.py` - RAG查询核心功能（Query改写、向量化、搜索、重排序、答案生成）
- `README.md` - 使用说明文档
- `__init__.py` - 模块导出

#### `src/intent/` - 问题理解与能力路由模块
- `classification.py` - 问题理解与意图识别核心功能（问题拆分、CoT推理、意图分类、能力路由）
- `router.py` - 查询路由功能（整合问题理解、意图识别和RAG查询）
- `README.md` - 使用说明文档
- `README.md` - 使用说明文档
- `__init__.py` - 模块导出

#### `src/prediction/` - 预测模型模块（待实现）
- LightGBM模型
- Transformer模型
- 客户贷款意向预测
- 趋势分析

#### `src/utils/` - 工具函数
- `monitor.py` - Token监控和时间监控模块
- 文档处理工具（待实现）
- 数据库操作（待实现）

**注意**：Query改写功能已集成到 `app.py` 中，不再作为独立模块

#### `src/api/` - API接口（可选）
- RESTful API
- 接口封装

#### `src/models/` - 数据模型（待实现）
- 数据模型定义
- 数据库模型

---

### 3. **app.py** - 应用入口
项目主入口文件，接收用户query并执行完整的查询流程

**功能流程**：
1. 接收用户query
2. Query改写（将口语化问题改写为规范化查询）
3. 问题理解与意图识别
4. 路由决策
5. 调用对应功能（RAG查询或预测）
6. 返回结果

**使用方式**：
```python
from app import query

# 基本查询
result = query("小额贷款公司的注册资本要求是什么？")
print(result['answer'])
```

**命令行使用**：
```bash
python app.py "小额贷款公司的注册资本要求是什么？"
python app.py "查询政策" --role 团队负责人
```

---

### 4. **scripts/** - 脚本目录
数据处理和模型训练的脚本（一次性运行）

#### `scripts/data_processing/` - 数据处理脚本
- 文档清洗脚本
- Mineru解析脚本
- 文本切分脚本
- 数据入库脚本

#### `scripts/data_import/` - 数据导入脚本
- 客户数据导入脚本

#### `scripts/rag/` - RAG向量库生成脚本
- `build_vector_db.py` - 向量库生成脚本（一次性运行）
- `README_向量库生成说明.md` - 使用说明
- `Elasticsearch启动说明.md` - ES启动说明

#### `scripts/qa_generation/` - QA对生成脚本
- `generate_qa_pairs.py` - 从文档生成QA对
- `README_QA生成说明.md` - 使用说明

#### `scripts/model_training/` - 模型训练脚本（待实现）
- LightGBM训练脚本
- Transformer训练脚本
- 模型调参脚本

---

### 4. **ui/** - 用户界面目录
Streamlit/Dash界面相关代码

#### `ui/streamlit/` - Streamlit主应用
- 主应用入口
- 页面路由

#### `ui/components/` - 界面组件
- 可复用的UI组件
- 图表组件
- 输入输出组件

#### `ui/pages/` - 页面模块
- 政策查询页面
- 系统功能指导页面
- 客户分析页面
- 预测结果展示页面

---

### 5. **config/** - 配置文件目录
项目配置文件

- 模型配置
- 数据库配置
- RAG参数配置
- 权限配置

---

### 6. **models/** - 模型文件目录
保存训练好的模型文件

#### `models/lightgbm/` - LightGBM模型
- 训练好的LightGBM模型文件

#### `models/transformer/` - Transformer模型
- 训练好的Transformer模型文件

#### `models/embedding/` - Embedding模型
- 文本嵌入模型文件

---

### 7. **logs/** - 日志目录
系统运行日志

- 应用日志
- 错误日志
- 训练日志

---

### 8. **docs/** - 文档目录
项目文档

- API文档
- 使用说明
- 开发文档

---

### 9. **其他文件**
- `需求.md` - 项目需求文档
- `项目结构说明.md` - 本文件
- `requirements.txt` - Python依赖包（待创建）
- `README.md` - 项目说明（待创建）

---

## 📋 工作流程对应目录

根据需求文档中的准备顺序，各步骤对应的目录：

1. **整理文档** → `data/raw/` 或 `pre_docs/`
2. **文件清洗** → `data/processed/`
3. **Mineru解析** → `data/parsed/`
4. **生成QA对** → `data/qa_pairs/`
5. **数据入库** → `data/customer/`
6. **RAG向量库生成** → `data/vector_db/`
7. **文本切分** → `scripts/rag/build_vector_db.py` → `data/vector_db/`
8. **RAG查询流程** → `src/rag/query.py`（核心代码）
9. **预测模型训练** → `scripts/model_training/` → `models/`
10. **意图识别** → `src/intent/classification.py`（核心代码）
11. **界面搭建** → `ui/`
12. **系统集成** → `ui/streamlit/`

---

## 🔒 权限与安全说明

- 所有客户数据存放在 `data/customer/`，必须为模拟/脱敏数据
- RAG系统不存储敏感客户数据，仅提供政策与功能辅助
- 预测模块仅用于模拟分析，不参与实际审批或授信
- 权限控制配置在 `config/` 目录

---

## 📝 注意事项

1. 所有客户数据必须模拟/脱敏，Demo不使用真实客户数据
2. 文档解析建议使用Mineru本地解析
3. QA对重点在"条款级别"，不是每句话都做QA
4. Metadata设计需包含：域、政策类型、政策时间、查询权限控制


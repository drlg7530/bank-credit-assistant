项目名称：智能信贷业务辅助系统

一、项目目标：构建一个面向业务人员的智能辅助系统，通过大模型 RAG + 客户预测模块，提升业务人员对政策、系统功能和客户风险的理解与操作效率。
1.帮助业务人员快速查询政策与规则说明
2.提供信贷系统功能与操作指引
3.对客户历史数据进行解释性分析与趋势展示

二、实现方式：本地大模型 + RAG系统 + 预测模型

三、项目功能：
1.政策查询与风险提示
	为业务人员提供基于公开政策和监管文件的快速查询
	提供模拟客户的风险提示与操作参考
	不参与、不替代任何审批或授信决策
2.系统功能指导
	业务人员可能不熟悉信贷系统功能，容易误操作
	Demo 引入开发人员的设计文档或功能说明
	给业务人员提供 操作流程指导 + 功能使用示例
3.客户贷款意向预测能力（可选模块）
	基于模拟客户数据进行预测
	演示模型能力、趋势分析
	协助业务人员主动推荐产品
	可结合意图识别路由问题到 RAG 或预测模块

四、准备工作
A. 数据准备
数据类型	来源	使用方式
政策文档	公开银行政策、监管文件	解析为文本 → 切分 → RAG向量库
系统功能文档	模拟或脱敏的信贷系统功能说明	解析为文本 → 切分 → RAG向量库
客户数据	本地模拟数据库（JSON/SQLite）	用于预测模块演示，带客户经理字段
预测标签/历史	模拟或生成	用于训练 LightGBM/Transformer 模型，展示趋势和决策依据

注意事项：
所有客户数据必须 模拟/脱敏，面试 Demo 不使用真实客户
文档解析建议：Mineru 本地解析或 Python PDF/Word 库 → 文本切分
QA 对整理（可选）：从文档中抽取常见业务问题 → 对应答案 → 向量化，提升 RAG 检索精度


五、详细设计
1.整理文档（政策文件准备 +  系统操作手册文档 + 文档分域） √
2.文件清洗（多页图片时使用ocr结构修复：保证条款级连续性和可追溯性） √
3.mineru解析文档成markdown √
4.数据入库（客户数据入本地数据库，cursor自动加comments） √
5.对解析后文档初步切分并根据域生成Q、A对（1.按条款/章节/语义块切分，不使用llm；2.使用llm生成QA对，Q为大模型生成、A为政策或操作手册的功能点） √
6.QA对原子化（按照域分类，使用llm对每个文档生成多个QA对，每一条QA对，满足「一个问题 = 一个独立知识点」,相比与两步chunk更加白盒） √
7.QA对的Metadata注入（设计Metadata：1.区分域2.政策类型3.政策时间4.查询权限控制，为每条QA对增加metadata信息） √
8.QA 对索引构建与 ES 入库（保存到Elasticsearch，同时保存向量化数据和非向量化数据：
   - 单个索引{index_name} + ES 原生 Hybrid Search，实现混合搜索（BM25 + 向量搜索）） √
9.query改写、向量化，rag重排序，大模型返回内容 √
10.大模型意图识别（CoT思维链推理） √
11.功能串联（query → query改写 → 意图识别 → Elasticsearch混合搜索（BM25 + 向量）或预测 → llm总结返回内容） √
12.预测模型训练（协助分析客户贷款意向）
13.LightGBM → 模拟数据训练 → 调参
14.界面搭建flask √
监控：包含token监控与时间监控 √
系统边界说明：（RAG不存储敏感客户数据，仅提供政策与功能辅助；预测模块仅模拟分析，不参与审批或授信；权限控制模拟不同业务角色访问）

系统提示词全部提取到config里一个文件配置。

QA对说明：
场景	QA 条数建议	说明


metadata设计：
{
  "domain": "policy", ##policy | system
  "doc_type": "监管政策", ##监管政策 | 内部制度 | 系统说明 | 操作手册
  "source": "国家金融监督管理总局",  ##文档来源
  "region": "全国", ##全国 | 新疆
  "role": "客户经理", ##客户经理 | 团队负责人 | 行长
  "status": "生效"  ##生效 | 已失效
}

token监控设计：
1.每一次 LLM 调用就记录，示例：
{
  "trace_id": "uuid",
  "module": "intent_router",
  "model": "gpt-4o-mini / qwen2.5",
  "prompt_tokens": 420,
  "completion_tokens": 98,
  "total_tokens": 518,
  "latency_ms": 820,
  "timestamp": "2025-01-10 14:32:10"
}
2.把一次用户请求下的多次调用聚合起来，示例：
{
  "trace_id": "uuid",
  "user_query": "这个客户风险高不高？现在政策还支不支持？",
  "steps": [
    {
      "module": "intent_router",
      "tokens": 518
    },
    {
      "module": "policy_rag_answer",
      "tokens": 1240
    },
    {
      "module": "prediction_explain",
      "tokens": 310
    }
  ],
  "total_tokens": 2068
}

时间监控：
统计不同步骤耗费的时间（query重写 / 意图识别 / RAG / 预测 / 重排序 / 最终回答）

缓存：
redis缓存query+query改写结果，节省调用query改写的token，不直接缓存llm结果，避免返回预测敏感信息与时效性问题

权限逻辑演示：
模拟客户经理身份 → 查询过滤
整合 Demo 流程
输入 → 意图识别 → 路由 → 输出 → 可视化展示

prompt管理：
1.后期增加PromptManager 类管理模板，支持动态加载
2.给每个模板增加 version 或 last_update 字段，方便迭代

最后总结库list